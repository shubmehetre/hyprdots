#!/usr/bin/env bash

CONF="$HOME/.config/hypr/hyprpaper.conf"
IMG="$1"

if [ ! -f "$IMG" ]; then
  notify-send "Hyprpaper" "Invalid file: $IMG"
  exit 1
fi

# Ensure config dir exists
mkdir -p "$(dirname "$CONF")"

# Preload the image once
hyprctl hyprpaper preload "$IMG"

# Reset config file
echo "# Auto-generated by set-hyprpaper-wallpaper.sh" >"$CONF"
echo "preload = $IMG" >>"$CONF"

# Loop over all active monitors and set wallpaper
for MON in $(hyprctl monitors -j | jq -r '.[].name'); do
  hyprctl hyprpaper wallpaper "$MON,$IMG"
  echo "wallpaper = $MON,$IMG" >>"$CONF"
done

notify-send "Hyprpaper" "Wallpaper set on all monitors: $IMG"
